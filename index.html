<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Admin Panel</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{margin:0;background:#050814;color:#fff;font-family:Arial}
.hidden{display:none}
.container{max-width:720px;margin:auto;padding:20px}
h1,h2{text-align:center;color:#00eaff}
input,textarea,select,button{
  width:100%;margin-top:10px;padding:12px;
  border-radius:12px;border:none;font-size:15px
}
input,textarea,select{background:#0b1025;color:#0ff}
textarea{height:160px;resize:none}
button{background:linear-gradient(135deg,#00eaff,#1e90ff);font-weight:bold;cursor:pointer}
.producto{background:#0b1025;padding:10px;border-radius:10px;margin-top:8px}
.log{text-align:center;margin-top:10px;color:#ff5555}
.ok{color:#00ff88}
.logout{background:#ff0033;color:#fff}
</style>
</head>

<body>

<!-- ðŸ” LOGIN -->
<div class="container" id="loginBox">
  <h1>LOGIN ADMIN</h1>
  <input id="email" type="email" placeholder="Correo">
  <input id="password" type="password" placeholder="ContraseÃ±a">
  <button id="btnLogin">ENTRAR</button>
  <div id="loginMsg" class="log"></div>
</div>

<!-- ðŸŽ® PANEL -->
<div class="container hidden" id="panelBox">
  <h1>PANEL ADMIN</h1>

  <h2>Productos</h2>
  <select id="productosSelect"></select>
  <div id="productosLista"></div>

  <h2>Agregar keys al producto</h2>
  <textarea id="keysInput" placeholder="B MODSKEY
B MODKEY
ðŸ‘¤Brmods
ðŸ”‘brmods clave"></textarea>

  <button id="btnAddKeys">AGREGAR KEYS</button>
  <div id="keysMsg" class="log ok"></div>

  <button class="logout" id="btnLogout">SALIR</button>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import {
  getAuth,
  signInWithEmailAndPassword,
  onAuthStateChanged,
  signOut
} from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";

import {
  getFirestore,
  collection,
  getDocs,
  doc,
  updateDoc,
  setDoc,
  arrayUnion
} from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

/* ðŸ”´ TU CONFIG */
const firebaseConfig = {
  apiKey: "TU_API_KEY",
  authDomain: "TU_PROYECTO.firebaseapp.com",
  projectId: "TU_PROYECTO",
  storageBucket: "TU_PROYECTO.appspot.com",
  messagingSenderId: "ID",
  appId: "APP_ID"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

/* ðŸ” LOGIN */
btnLogin.onclick = ()=>{
  const e = email.value.trim();
  const p = password.value.trim();

  if(!e || !p){
    loginMsg.innerText = "Completa los datos";
    return;
  }

  signInWithEmailAndPassword(auth,e,p)
    .catch(err => loginMsg.innerText = err.message);
};

/* ðŸ‘ï¸ SESIÃ“N */
onAuthStateChanged(auth,user=>{
  if(user){
    loginBox.classList.add("hidden");
    panelBox.classList.remove("hidden");
    cargarProductos();
  }else{
    panelBox.classList.add("hidden");
    loginBox.classList.remove("hidden");
  }
});

/* ðŸ“¦ PRODUCTOS */
let productoActual = null;

async function cargarProductos(){
  const snap = await getDocs(collection(db,"productos"));
  productosSelect.innerHTML="";
  productosLista.innerHTML="";

  snap.forEach(d=>{
    const p = d.data();
    const opt = document.createElement("option");
    opt.value = d.id;
    opt.textContent = p.nombre;
    productosSelect.appendChild(opt);

    const div = document.createElement("div");
    div.className="producto";
    div.innerHTML=`${p.nombre} | ${p.precio} | ${p.dias} dÃ­as`;
    productosLista.appendChild(div);
  });

  productoActual = productosSelect.value;
}

productosSelect.onchange = ()=> productoActual = productosSelect.value;

/* ðŸ”‘ AGREGAR KEYS */
btnAddKeys.onclick = async ()=>{
  if(!productoActual) return;

  const texto = keysInput.value.trim();
  if(!texto) return;

  const ref = doc(db,"keys",productoActual);

  await setDoc(ref,{lista:[]},{merge:true});

  let count = 0;
  for(const l of texto.split("\n")){
    const linea = l.trim();
    if(linea){
      await updateDoc(ref,{
        lista: arrayUnion(linea)
      });
      count++;
    }
  }

  keysMsg.innerText = `âœ” ${count} keys agregadas`;
  keysInput.value="";
};

/* ðŸ”“ LOGOUT */
btnLogout.onclick = ()=> signOut(auth);
</script>
</body>
</html>