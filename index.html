<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Key Generator</title>

<!-- üî• Firebase v9 COMPAT (OBLIGATORIO) -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
body{
  margin:0;
  background:#06010d;
  font-family:Arial,Helvetica,sans-serif;
  color:#fff;
  display:flex;
  justify-content:center;
  align-items:center;
  min-height:100vh;
}
.card{
  width:90%;
  max-width:420px;
  background:#0c0718;
  border-radius:22px;
  padding:24px;
  box-shadow:0 0 40px #7f4cff;
}
h2{
  text-align:center;
  color:#b57cff;
}
label{display:block;margin-top:14px;}
select,textarea{
  width:100%;
  margin-top:6px;
  padding:14px;
  border-radius:14px;
  border:none;
  background:#120c22;
  color:#fff;
}
textarea{min-height:120px;}
button{
  width:100%;
  margin-top:18px;
  padding:14px;
  border:none;
  border-radius:18px;
  background:linear-gradient(135deg,#8a5cff,#c58bff);
  font-weight:bold;
}
.msg{text-align:center;margin-top:10px;}
.error{color:#ff5b5b;}
.ok{color:#5bff9a;}
</style>
</head>

<body>

<div class="card">
  <h2>üîë Key Generator</h2>

  <label>Producto</label>
  <select id="producto">
    <option>Cargando...</option>
  </select>

  <label>Keys (1 por l√≠nea)</label>
  <textarea id="keys"></textarea>

  <button onclick="guardar()">‚ö° AGREGAR KEYS</button>
  <div id="msg" class="msg"></div>
</div>

<script>
/* ‚úÖ TU FIREBASE REAL */
const firebaseConfig = {
  apiKey: "AIzaSyAKrBTAkJGhB9s3E3MExqzj8mtXgKYsWRc",
  authDomain: "davidstore-51f7f.firebaseapp.com",
  projectId: "davidstore-51f7f"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

/* üîÑ CARGAR PRODUCTOS */
const sel = document.getElementById("producto");
sel.innerHTML = "<option>Cargando...</option>";

db.collection("claves").get().then(snap=>{
  sel.innerHTML = "<option value=''>Selecciona producto</option>";
  if(snap.empty){
    sel.innerHTML += "<option disabled>No hay productos</option>";
    return;
  }
  snap.forEach(doc=>{
    const o=document.createElement("option");
    o.value=doc.id;
    o.textContent=doc.id;
    sel.appendChild(o);
  });
}).catch(e=>{
  console.error(e);
  sel.innerHTML="<option>Error Firebase</option>";
});

/* ‚ûï GUARDAR KEYS */
function guardar(){
  const prod=sel.value;
  const texto=document.getElementById("keys").value.trim();
  const msg=document.getElementById("msg");

  if(!prod){msg.textContent="‚ùå Selecciona producto";msg.className="msg error";return;}
  if(!texto){msg.textContent="‚ùå Pega keys";msg.className="msg error";return;}

  const arr=texto.split("\n").map(x=>x.trim()).filter(x=>x);

  db.collection("claves").doc(prod).update({
    lista: firebase.firestore.FieldValue.arrayUnion(...arr)
  }).then(()=>{
    msg.textContent="‚úÖ Keys agregadas";
    msg.className="msg ok";
    document.getElementById("keys").value="";
  }).catch(e=>{
    console.error(e);
    msg.textContent="‚ùå Error al guardar";
    msg.className="msg error";
  });
}
</script>

</body>
</html>