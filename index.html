<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Key Generator Admin</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- ===== FIREBASE COMPAT ===== -->
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>

<style>
body{
  background:radial-gradient(circle at top,#1a1033,#05010a);
  font-family:Arial,Helvetica,sans-serif;
  color:#fff;
  margin:0;
  padding:0;
}
.key-panel{
  max-width:420px;
  margin:40px auto;
  background:#070b18;
  padding:24px;
  border-radius:26px;
  box-shadow:0 0 35px #a855f7;
}
.key-panel h2{
  text-align:center;
  color:#c084fc;
  letter-spacing:1px;
}
.key-panel label{
  display:block;
  margin-top:16px;
  opacity:.85;
}
.key-panel select,
.key-panel textarea{
  width:100%;
  margin-top:8px;
  padding:14px;
  border-radius:16px;
  border:none;
  background:#0f172a;
  color:#fff;
  font-size:15px;
}
.key-panel textarea{
  min-height:140px;
  resize:none;
}
.key-panel button{
  width:100%;
  margin-top:22px;
  padding:18px;
  border:none;
  border-radius:20px;
  font-size:18px;
  font-weight:900;
  cursor:pointer;
  background:linear-gradient(135deg,#c084fc,#7c3aed);
  color:#000;
  box-shadow:0 0 25px #a855f7;
}
.key-panel button:hover{
  transform:scale(1.02);
}
#kgMsg{
  margin-top:14px;
  text-align:center;
  font-weight:700;
}
.hidden{display:none}
</style>
</head>

<body>

<div class="key-panel">
  <h2>üîë Key Generator</h2>

  <label>Product Type</label>
  <select id="kgProducto">
    <option value="brmods">BR Mods</option>
  </select>

  <label>Validity</label>
  <select id="kgDias">
    <option value="1">1 Day - $0.99</option>
    <option value="7">7 Days</option>
    <option value="30">30 Days</option>
  </select>

  <label>Agregar Keys (1 por l√≠nea)</label>
  <textarea id="kgKeys"
    placeholder="PEGA AQU√ç LAS KEYS
UNA POR L√çNEA
EJEMPLO:
KEY-AAA
KEY-BBB
KEY-CCC"></textarea>

  <button onclick="agregarKeys()">‚ö° AGREGAR KEYS</button>

  <div id="kgMsg" class="hidden"></div>
</div>

<script>
// üî• CONFIGURA TU FIREBASE
firebase.initializeApp({
  apiKey: "AIzaSyAKrBTAkJGhB9s3E3MExqzj8mtXgKYsWRc",
  authDomain: "davidstore-51f7f.firebaseapp.com",
  projectId: "davidstore-51f7f"
});
const db = firebase.firestore();

// üöÄ AGREGAR KEYS REAL
async function agregarKeys(){
  const producto = document.getElementById("kgProducto").value;
  const dias = document.getElementById("kgDias").value;
  const texto = document.getElementById("kgKeys").value.trim();
  const msg = document.getElementById("kgMsg");

  msg.classList.add("hidden");

  if(!texto){
    msg.textContent = "‚ùå No hay keys";
    msg.classList.remove("hidden");
    return;
  }

  // convertir texto a array (1 por l√≠nea)
  const nuevasKeys = texto
    .split("\n")
    .map(k => k.trim())
    .filter(k => k.length > 0);

  if(nuevasKeys.length === 0){
    msg.textContent = "‚ùå Formato inv√°lido";
    msg.classList.remove("hidden");
    return;
  }

  const docID = producto + "_" + dias + "d";
  const ref = db.collection("claves").doc(docID);

  try{
    await db.runTransaction(async tx=>{
      const snap = await tx.get(ref);

      if(!snap.exists){
        tx.set(ref,{
          producto: "BR Mods",
          dias: Number(dias),
          lista: nuevasKeys
        });
      }else{
        const actuales = snap.data().lista || [];
        tx.update(ref,{
          lista: actuales.concat(nuevasKeys)
        });
      }
    });

    msg.textContent = "‚úÖ " + nuevasKeys.length + " keys agregadas";
    msg.style.color = "#22c55e";
    msg.classList.remove("hidden");
    document.getElementById("kgKeys").value = "";

  }catch(e){
    msg.textContent = "‚ùå Error al guardar";
    msg.style.color = "#ef4444";
    msg.classList.remove("hidden");
  }
}
</script>

</body>
</html>