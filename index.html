<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Key Generator Admin</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- FIREBASE -->
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>

<style>
body{
  background:radial-gradient(circle at top,#1a1033,#05010a);
  font-family:Arial, sans-serif;
  color:#fff;
}
.panel{
  max-width:420px;
  margin:40px auto;
  background:#070b18;
  padding:26px;
  border-radius:26px;
  box-shadow:0 0 40px #a855f7;
}
h2{
  text-align:center;
  color:#c084fc;
  margin-bottom:20px;
}
label{
  display:block;
  margin-top:16px;
  opacity:.85;
}
select, textarea{
  width:100%;
  margin-top:8px;
  padding:14px;
  border-radius:16px;
  border:none;
  background:#0f172a;
  color:#fff;
  font-size:15px;
}
textarea{
  min-height:150px;
  resize:none;
  font-family:monospace;
}
button{
  width:100%;
  margin-top:22px;
  padding:18px;
  border:none;
  border-radius:20px;
  font-size:18px;
  font-weight:900;
  background:linear-gradient(135deg,#c084fc,#7c3aed);
  color:#000;
  cursor:pointer;
}
#msg{
  text-align:center;
  margin-top:14px;
  font-weight:700;
}
.hidden{display:none}
</style>
</head>

<body>

<div class="panel">
  <h2>üîë Key Generator</h2>

  <label>Producto / Duraci√≥n</label>
  <select id="producto">
    <option value="">Cargando...</option>
  </select>

  <label>Agregar Keys (1 por l√≠nea)</label>
  <textarea id="keys" placeholder="KEY-12345
KEY-67890
KEY-ABCDE"></textarea>

  <button onclick="agregarKeys()">‚ö° AGREGAR KEYS</button>
  <div id="msg" class="hidden"></div>
</div>

<script>
// üî• CONFIGURA TU FIREBASE (NO CAMBIES NADA M√ÅS)
firebase.initializeApp({
  apiKey: "TU_API_KEY",
  authDomain: "TU_AUTH_DOMAIN",
  projectId: "TU_PROJECT_ID"
});
const db = firebase.firestore();

// üîÑ CARGAR TODOS LOS PRODUCTOS DESDE "claves"
db.collection("claves").onSnapshot(snap=>{
  const sel = document.getElementById("producto");
  sel.innerHTML = "<option value=''>Selecciona producto</option>";

  snap.forEach(doc=>{
    const opt = document.createElement("option");
    opt.value = doc.id;
    opt.textContent = doc.id; // üëà mostramos el ID tal cual
    sel.appendChild(opt);
  });
});

// üíæ AGREGAR KEYS
async function agregarKeys(){
  const msg = document.getElementById("msg");
  msg.classList.add("hidden");

  const producto = document.getElementById("producto").value;
  const texto = document.getElementById("keys").value.trim();

  if(!producto){
    mostrarError("Selecciona un producto");
    return;
  }

  if(!texto){
    mostrarError("No hay keys");
    return;
  }

  const nuevasKeys = texto
    .split("\n")
    .map(k=>k.trim())
    .filter(k=>k.length > 0);

  const ref = db.collection("claves").doc(producto);

  try{
    await db.runTransaction(async tx=>{
      const snap = await tx.get(ref);
      if(!snap.exists){
        tx.set(ref,{ lista: nuevasKeys });
      }else{
        const actuales = snap.data().lista || [];
        tx.update(ref,{
          lista: actuales.concat(nuevasKeys)
        });
      }
    });

    document.getElementById("keys").value="";
    mostrarOk("Keys agregadas: " + nuevasKeys.length);

  }catch(e){
    console.error(e);
    mostrarError("Error al guardar (rules)");
  }
}

function mostrarError(t){
  const msg = document.getElementById("msg");
  msg.textContent = "‚ùå " + t;
  msg.style.color = "#f87171";
  msg.classList.remove("hidden");
}

function mostrarOk(t){
  const msg = document.getElementById("msg");
  msg.textContent = "‚úÖ " + t;
  msg.style.color = "#22c55e";
  msg.classList.remove("hidden");
}
</script>

</body>
</html>