<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Panel Admin</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
*{box-sizing:border-box}
body{
  margin:0;
  background:#080411;
  font-family:Arial,Helvetica,sans-serif;
  color:#fff;
}
.top{
  display:flex;
  justify-content:center;
  gap:14px;
  padding:14px;
}
.top button{
  padding:12px 20px;
  border:none;
  border-radius:14px;
  background:#6f3cff;
  color:#000;
  font-weight:bold;
}
.page{
  display:none;
  max-width:460px;
  margin:20px auto;
  background:#120a24;
  border-radius:22px;
  padding:20px;
  box-shadow:0 0 40px #7a3cff;
}
.page.active{display:block}
h2{
  text-align:center;
  color:#b57cff;
}
.user{
  background:#1b0f38;
  padding:12px;
  border-radius:14px;
  margin:10px 0;
}
select,textarea,input,button{
  width:100%;
  margin-top:10px;
  padding:14px;
  border:none;
  border-radius:14px;
  background:#1b0f38;
  color:#fff;
}
textarea{min-height:140px}
.btn{
  background:linear-gradient(135deg,#8a5cff,#c58bff);
  color:#000;
  font-weight:bold;
}
.msg{text-align:center;margin-top:10px}
.ok{color:#5bff9a}
.err{color:#ff5b5b}
</style>
</head>

<body>

<!-- ðŸ” MENU -->
<div class="top">
  <button onclick="show('saldos')">ðŸ’° SALDOS</button>
  <button onclick="show('keys')">ðŸ”‘ KEYS</button>
</div>

<!-- ðŸ’° SALDOS -->
<div id="saldos" class="page active">
  <h2>ðŸ’° SALDOS</h2>
  <input id="buscar" placeholder="Buscar correo o ID">
  <div id="lista">Cargando usuarios...</div>
</div>

<!-- ðŸ”‘ KEYS -->
<div id="keys" class="page">
  <h2>ðŸ”‘ KEYS</h2>

  <select id="producto">
    <option>Cargando productos...</option>
  </select>

  <textarea id="keysTxt" placeholder="1 key por lÃ­nea"></textarea>
  <button class="btn" onclick="guardarKeys()">AGREGAR KEYS</button>
  <div id="msgKeys" class="msg"></div>
</div>

<!-- ðŸ”¥ FIREBASE -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getAuth, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import {
  getFirestore,
  collection,
  getDocs,
  addDoc
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

/* ðŸ”´ TUS DATOS */
const ADMIN_EMAIL = "admin@admin.com";
const ADMIN_PASSWORD = "TU_PASSWORD";

const firebaseConfig = {
  apiKey: "TU_API_KEY",
  authDomain: "TU_DOMINIO",
  projectId: "TU_PROJECT_ID"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

/* ðŸ” LOGIN ADMIN */
signInWithEmailAndPassword(auth,ADMIN_EMAIL,ADMIN_PASSWORD)
.then(()=>{
  cargarUsuarios();
  cargarProductos();
})
.catch(e=>alert("ERROR LOGIN: "+e.message));

/* ðŸ“„ SALDOS */
let usuariosCache=[];
async function cargarUsuarios(){
  const cont=document.getElementById("lista");
  cont.innerHTML="";
  const snap=await getDocs(collection(db,"usuarios"));
  usuariosCache=[];
  snap.forEach(d=>{
    usuariosCache.push({id:d.id,...d.data()});
  });
  renderUsuarios(usuariosCache);
}

function renderUsuarios(arr){
  const cont=document.getElementById("lista");
  cont.innerHTML="";
  if(!arr.length){
    cont.textContent="Sin usuarios";
    return;
  }
  arr.forEach(u=>{
    cont.innerHTML+=`
      <div class="user">
        ðŸ“§ ${u.email || u.id}<br>
        ðŸ’Ž Saldo: <b>${u.saldo || 0}</b>
      </div>`;
  });
}

document.getElementById("buscar").oninput=e=>{
  const v=e.target.value.toLowerCase();
  renderUsuarios(
    usuariosCache.filter(u=>
      (u.email||"").toLowerCase().includes(v) ||
      u.id.toLowerCase().includes(v)
    )
  );
};

/* ðŸ”‘ PRODUCTOS */
async function cargarProductos(){
  const sel=document.getElementById("producto");
  sel.innerHTML="<option value=''>Selecciona producto</option>";
  const snap=await getDocs(collection(db,"productos"));
  snap.forEach(d=>{
    sel.innerHTML+=`<option value="${d.id}">${d.data().nombre||d.id}</option>`;
  });
}

/* âž• GUARDAR KEYS */
window.guardarKeys = async()=>{
  const prod=document.getElementById("producto").value;
  const txt=document.getElementById("keysTxt").value.trim();
  const msg=document.getElementById("msgKeys");

  if(!prod||!txt){
    msg.textContent="âŒ Falta producto o keys";
    msg.className="msg err";
    return;
  }

  const arr=txt.split("\n").map(x=>x.trim()).filter(x=>x);

  for(const k of arr){
    await addDoc(collection(db,"claves"),{
      producto:prod,
      key:k,
      usada:false,
      fecha:Date.now()
    });
  }

  msg.textContent="âœ… Keys guardadas";
  msg.className="msg ok";
  document.getElementById("keysTxt").value="";
};

/* ðŸ” CAMBIO DE PAGINA */
window.show=id=>{
  document.querySelectorAll(".page").forEach(p=>p.classList.remove("active"));
  document.getElementById(id).classList.add("active");
};
</script>

</body>
</html>