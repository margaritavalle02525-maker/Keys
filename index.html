<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Admin Panel ğŸ®</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body{margin:0;background:#050814;color:#fff;font-family:Arial}
.hidden{display:none}
.container{max-width:720px;margin:auto;padding:20px}
h1,h2{text-align:center;color:#00eaff}
input,textarea,select,button{
  width:100%;margin-top:10px;padding:12px;
  border-radius:12px;border:none;font-size:15px
}
input,textarea,select{background:#0b1025;color:#0ff}
textarea{height:160px;resize:none}
button{background:linear-gradient(135deg,#00eaff,#1e90ff);font-weight:bold}
.producto{background:#0b1025;padding:10px;border-radius:10px;margin-top:8px}
.log{text-align:center;margin-top:10px;color:#ff4444}
.ok{color:#00ff88}
</style>
</head>

<body>

<!-- LOGIN -->
<div class="container" id="loginBox">
  <h1>ğŸ” LOGIN</h1>
  <input id="loginKey" placeholder="Key de acceso">
  <button id="btnLogin">ENTRAR</button>
  <div id="loginMsg" class="log"></div>
</div>

<!-- PANEL -->
<div class="container hidden" id="panelBox">
  <h1>ğŸ® PANEL ADMIN</h1>

  <h2>ğŸ“¦ Productos</h2>
  <select id="productosSelect"></select>
  <div id="productosLista"></div>

  <h2>ğŸ”‘ Agregar Keys al producto</h2>
  <textarea id="keysInput" placeholder="KEY1
KEY2
ğŸ‘¤Brmods
ğŸ”‘brmods clave"></textarea>
  <button id="btnAddKeys">AGREGAR KEYS</button>
  <div id="keysMsg" class="log ok"></div>

  <button onclick="logout()" style="background:#ff0033;color:#fff">SALIR</button>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import {
  getFirestore, collection, getDocs, doc, getDoc, updateDoc, arrayUnion
} from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

/* ğŸ”´ TU CONFIG */
const firebaseConfig = {
  apiKey: "TU_API_KEY",
  authDomain: "TU_PROYECTO.firebaseapp.com",
  projectId: "TU_PROYECTO",
  storageBucket: "TU_PROYECTO.appspot.com",
  messagingSenderId: "ID",
  appId: "APP_ID"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

/* ğŸ” LOGIN SOLO VALIDA */
const loginDoc = doc(db,"claves","BRMODS_15DIAS");

btnLogin.onclick = async ()=>{
  const key = loginKey.value.trim();
  if(!key) return loginMsg.innerText="âŒ Ingresa una key";

  const snap = await getDoc(loginDoc);
  if(!snap.exists()) return loginMsg.innerText="âŒ Login no existe";

  if((snap.data().lista||[]).includes(key)){
    loginBox.classList.add("hidden");
    panelBox.classList.remove("hidden");
    cargarProductos();
  }else{
    loginMsg.innerText="âŒ Key invÃ¡lida";
  }
};

/* ğŸ“¦ PRODUCTOS */
let productoActual = null;

async function cargarProductos(){
  const snap = await getDocs(collection(db,"productos"));
  productosSelect.innerHTML="";
  productosLista.innerHTML="";

  snap.forEach(d=>{
    const p = d.data();
    const opt = document.createElement("option");
    opt.value = d.id;
    opt.textContent = p.nombre;
    productosSelect.appendChild(opt);

    const div = document.createElement("div");
    div.className="producto";
    div.innerHTML=`ğŸ® ${p.nombre} | ğŸ’° ${p.precio} | â³ ${p.dias}`;
    productosLista.appendChild(div);
  });

  productoActual = productosSelect.value;
}

productosSelect.onchange = ()=> productoActual = productosSelect.value;

/* ğŸ”‘ AGREGAR KEYS AL PRODUCTO */
btnAddKeys.onclick = async ()=>{
  if(!productoActual) return;

  const texto = keysInput.value.trim();
  if(!texto) return;

  const ref = doc(db,"keys",productoActual);
  let count=0;

  for(const l of texto.split("\n")){
    const linea = l.trim();
    if(linea){
      await updateDoc(ref,{ lista: arrayUnion(linea) });
      count++;
    }
  }

  keysMsg.innerText = `âœ… ${count} keys agregadas`;
  keysInput.value="";
};

/* SALIR */
window.logout = ()=>{
  panelBox.classList.add("hidden");
  loginBox.classList.remove("hidden");
};
</script>
</body>
</html>